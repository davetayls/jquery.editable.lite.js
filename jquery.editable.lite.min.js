(function($){var initialize,elementCurrentStyle,htmlEncode,multiLineHtmlEncode,multiLineHtmlDecode;$.fn.editable=function(command,options){var opts;if((typeof command==="function")||!command){opts=$.extend({},$.fn.editable.defaults);if(typeof options==="object"){opts=$.extend(opts,options)}opts.changeCallback=command;return this.each(function(){initialize.call(this,opts)})}};initialize=function(options){var target=this,form,elem,targetProps={},showEditableField,editableFieldFactory,restoreTarget,saveChanges,addPlaceHolderIfEmpty,stripPlaceHolder;showEditableField=function(evt){var getBackgroundColor,positioningSpan,offsetBy,inputText,eventAlreadyProcessed=false;stripPlaceHolder();targetProps.style=$(target).attr("style");targetProps.text=multiLineHtmlDecode($(target).html());targetProps.height=$(target).outerHeight();inputText=targetProps.text;if(typeof options.data==="function"){inputText=options.data.call(target,targetProps.text,target)}else{if(typeof options.data==="string"){inputText=options.data}}form=$('<form class="editable-lite-form">');elem=editableFieldFactory(options.type,target);elem.css("font-size",elementCurrentStyle(target,"font-size"));elem.css("font-family",elementCurrentStyle(target,"font-family"));elem.css("color",elementCurrentStyle(target,"color"));getBackgroundColor=function(node){var backgroundColor=elementCurrentStyle(node,"background-color");if(!backgroundColor||backgroundColor==="transparent"||backgroundColor==="inherit"){if($(node).parent().length){getBackgroundColor($(node).parent()[0])}else{return backgroundColor}}};elem.css("background-color",getBackgroundColor(target));positioningSpan=$("<span>&nbsp;</span>");$(target).prepend(positioningSpan);form.css("position","absolute").css("margin","0").css("padding","0").css("top",options.offsetY+$(target).position().top+"px").css("left",options.offsetY+$(positioningSpan).position().left+"px").css("z-index",options.zIndex).append(elem);offsetBy=$(positioningSpan).position().left-$(target).position().left;elem.css("padding",0).css("margin",0).css("width",($(target).outerWidth()-options.assumedBorderWidth-offsetBy)+"px");positioningSpan.remove();elem.val(inputText);$(target).css("height",$(target).height()+"px").text("");$(target).append(form);setTimeout(function(){targetProps.inputHeight=$(elem).height()},1);$(elem).focus();$(elem).blur(function(event){if(!eventAlreadyProcessed){eventAlreadyProcessed=true;if(options.acceptChangesOnBlur){saveChanges()}else{restoreTarget()}$(elem).unbind("blur")}});setTimeout(function(){$("html").bind("click.editable",function(){$(elem).trigger("blur")})},1);$(elem).click(function(event){event.stopPropagation()});$(elem).keydown(function(event){if(!eventAlreadyProcessed){if(event.which===13){if((options.type==="textarea")&&(event.ctrlKey||event.altKey||event.shiftKey)){event.stopPropagation()}else{eventAlreadyProcessed=true;saveChanges()}}else{if(event.which===27){eventAlreadyProcessed=true;restoreTarget()}else{if(event.which===9){eventAlreadyProcessed=true;saveChanges()}}}}if(!eventAlreadyProcessed&&(options.type==="textarea")&&(options.autoResize)){if($(elem).height()>targetProps.inputHeight){$(target).css("height",(targetProps.height+$(elem).height()-targetProps.inputHeight+10)+"px")}}})};editableFieldFactory=function(type,target){var elem;if(type==="textarea"){elem=$('<textarea name="value"></textarea>');if(options.autoResize){elem.TextAreaExpander(false,options.autoResizeMax)}else{elem.css("height",$(target).height()+"px")}}else{elem=$('<input type="text" name="value">');if(options.maxLength){elem.attr("maxlength",options.maxLength)}if(options.autoComplete){elem.attr("autocomplete","off");elem.autocomplete({source:($.isArray(options.autoComplete)?options.autoComplete:options.autoComplete()),minLength:0,delay:0})}}return elem};restoreTarget=function(newVal){var val=typeof newVal!=="undefined"?newVal:targetProps.text,encodedVal=multiLineHtmlEncode(val);$(target).attr("style",targetProps.style||"").html(encodedVal).append(form);$(target).data("editable-active",false);setTimeout(function(){form.hide().remove();$(target).find("form.editable-lite-form").remove();addPlaceHolderIfEmpty()},20);if((typeof newVal==="undefined")&&(typeof options.noChange==="function")){options.noChange.call(target,val)}$("html").unbind("click.editable")};saveChanges=function(){var returnVal;if(elem.val()!==targetProps.text){returnVal=options.changeCallback.call(target,elem.val(),target);if(returnVal){restoreTarget(returnVal)}else{restoreTarget(elem.val())}}else{restoreTarget()}};addPlaceHolderIfEmpty=function(){if(options.placeHolder&&($(target).html().replace(/\s+/g,"")==="")){$(target).html(options.placeHolder)}};stripPlaceHolder=function(){if(options.placeHolder&&($(target).html()===options.placeHolder)){$(target).html("")}};$(this).click(function(e){if($(target).data("editable-active")!=="true"){$(target).data("editable-active","true");if(options.displayDelay){setTimeout(function(){showEditableField()},options.displayDelay)}else{showEditableField()}}});addPlaceHolderIfEmpty()};elementCurrentStyle=function(element,styleName){if(element.currentStyle){var i=0,temp="",changeCase=false;for(i=0;i<styleName.length;i=i+1){if(styleName[i]!=="-"){temp+=(changeCase?styleName[i].toUpperCase():styleName[i]);changeCase=false}else{changeCase=true}}styleName=temp;return element.currentStyle[styleName]}else{return getComputedStyle(element,null).getPropertyValue(styleName)}};htmlEncode=function(value){if(value){return $("<span/>").text(value).html()}else{return""}};multiLineHtmlEncode=function(value){var lines,i;if(typeof value==="string"){lines=value.split(/\r\n|\r|\n/);for(i=0;i<lines.length;i=i+1){lines[i]=htmlEncode(lines[i])}return lines.join("<br/>")}else{return""}};multiLineHtmlDecode=function(html){html=html.split(/<br\s*\/?\s*>/);html=$.map(html,function(htmlFragment){return $("<span/>").html(htmlFragment).text()}).join("\n");return html};$.fn.editable.defaults={type:"text",offsetX:0,offsetY:0,assumedBorderWidth:4,acceptChangesOnBlur:true,data:false,maxLength:false,autoResize:false,autoResizeMax:300,noChange:false,placeHolder:false,autoComplete:false,zIndex:10000}}(jQuery));